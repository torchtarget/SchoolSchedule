<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Pickup Schedule</title>
  <style>
    table { border-collapse: collapse; margin-bottom: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: center; }
    th { background: #d9ead3; }
    tr.date-row { background: #cfe2f3; font-weight: bold; }
    td.label-cell { font-weight: bold; text-align: left; }
    .status-icon { cursor: pointer; }
  </style>
</head>
<body>
<h1>Pickup Schedule</h1>
<form method="post">
{% for w, week in enumerate(schedule) %}
  <table>
    <tr class="date-row">
      <td class="label-cell">Week {{ week.week_start.strftime('%W') }}</td>
      {% for date in get_week_dates(week.week_start) %}
        <th>{{ date }}</th>
      {% endfor %}
    </tr>
    {% for key, label in [('pick_up_1', 'Pick AM'), ('pick_up_2', 'Pick PM')] %}
      <tr>
        <td class="label-cell">{{ label }}</td>
        {% for d in range(days|length) %}
          <td>
            <input type="hidden" id="w{{ w }}_{{ key }}_{{ d }}" name="w{{ w }}_{{ key }}_{{ d }}" value="{{ week[key][d] }}">
            <span class="status-icon" data-input="w{{ w }}_{{ key }}_{{ d }}">{{ status_defs[week[key][d]].html|safe }}</span>
          </td>
        {% endfor %}
      </tr>
    {% endfor %}
  </table>
{% endfor %}
  <button type="submit">Save</button>
</form>
<script>
  const statusDefs = {{ status_defs | tojson }};
  const codes = Object.keys(statusDefs);
  document.querySelectorAll('.status-icon').forEach(function(el){
    el.addEventListener('click', function(){
      const input = document.getElementById(el.dataset.input);
      const idx = codes.indexOf(input.value);
      const next = codes[(idx + 1) % codes.length];
      input.value = next;
      el.innerHTML = statusDefs[next].html;
    });
  });
</script>
</body>
</html>
